using Microsoft.VisualStudio.TestTools.UnitTesting;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using OpenDentBusiness.Eclaims;
using UnitTestsCore;
using OpenDentBusiness;
using System.Reflection;

namespace UnitTests.IntegrationTests {
	[TestClass]
	public class InsVerifiesIntegrationTests {
		///<summary>This method will execute only once, just before any tests in this class run.</summary>
		[ClassInitialize]
		public static void SetupClass(TestContext testContext) {
		}

		///<summary>This method will execute just before each test in this class.</summary>
		[TestInitialize]
		public void SetupTest() {
		}

		[TestMethod]
		public void InsVerifies_Fake271ResponseSimple_ShouldPassValidation() {
			AppointmentT.ClearAppointmentTable();
			CarrierT.ClearCarrierTable();
			string suffix=MethodBase.GetCurrentMethod().Name;
			x270Controller.FakeResponseOverride271="ISA*00*          *00*          *30*330989922      *29*AA0989922      *030606*0936*U*00401*000013966*0*T*:~GS*HB*330989922*AA0989922*20030606*0936*13966*X*004010X092~ST*271*0001~BHT*0022*11*ASX012145WEB*20030606*0936~HL*1**20*1~NM1*PR*2*ACMEINC*****PI*12345~HL*2*1*21*1~NM1*1P*1*PROVLAST*PROVFIRST****SV*5558006~HL*3*2*22*0~TRN*2*100*1330989922~NM1*IL*1*SMITH*JOHN*B***MI*123456789~REF*6P*XYZ123*GROUPNAME~REF*18*2484568*TEST PLAN NAME~N3*29 FREMONT ST*~N4*PEACE*NY*10023~DMG*D8*19570515*M~DTP*307*RD8*19910712-19920525~EB*1*FAM*30~SE*17*0001~GE*1*13966~IEA*1*000013966~";
			long provNum=ProviderT.CreateProvider("prov1","terry","smith",ssn:"123456789",isUsingTIN:true,nationalProvID:"0123456789");
			Prefs.UpdateLong(PrefName.PracticeDefaultProv,provNum);
			Patient pat=PatientT.CreatePatient(suffix,priProvNum:provNum,birthDate:DateTime.Today);
			//Create clearinghouse, set required fields for benefit request validation, and set as default.
			Clearinghouse ch=ClearinghouseT.CreateClearinghouse("ClaimConnect",commBridge:EclaimsCommBridge.ClaimConnect,eFormat:ElectronicClaimFormat.x837D_5010_dental,isa05:"ZZ",
				isa07:"30",isa08:"BCBSGA",isa15:"P");
			Prefs.UpdateLong(PrefName.ClearinghouseDefaultEligibility,ch.ClearinghouseNum);
			Prefs.RefreshCache();
			Clearinghouses.Insert(ch);
			//Create carrier and set required fields for benefit request validation
			Carrier carrier=CarrierT.CreateCarrier(suffix,"123 boring st","boring","OR","97306","1234",arrayTrustedEtrans:TrustedEtransTypes.RealTimeEligibility);
			Carriers.RefreshCache();
			InsPlan insPlan=InsPlanT.CreateInsPlan(carrier.CarrierNum,groupNum:"XYZ123");//Group number should be >3 characters so it passes insverify validation
			InsSub insSub=InsSubT.CreateInsSub(pat.PatNum,insPlan.PlanNum);
			PatPlan patPlan=PatPlanT.CreatePatPlan(1,pat.PatNum,insSub.InsSubNum);
			Operatory op=OperatoryT.CreateOperatory();
			AppointmentT.CreateAppointment(pat.PatNum,DateTime.Today,op.OperatoryNum,provNum);
			List<InsVerify> listInsVerifies=InsVerifies.TryBatchPatInsVerify();
			//Should only be one patient in the list and they should have passed validation.
			Assert.IsTrue(listInsVerifies.FirstOrDefault().BatchVerifyState==BatchInsVerifyState.Success);
		}

		[TestMethod]
		public void InsVerifies_Fake271ResponseGuardian_IndividualGeneralDeductibleMismatchAndFamilyGeneralDeductibleMismatch() {
			AppointmentT.ClearAppointmentTable();
			CarrierT.ClearCarrierTable();
			string suffix=MethodBase.GetCurrentMethod().Name;
			x270Controller.FakeResponseOverride271="ISA*00*          *00*          *30*330989922      *ZZ*810624427      *190313*1132*U*00401*342242985*0*P*:~GS*HB*330989922*330989922*20190313*1132*342242985*X*004010X092A1~ST*271*0001~BHT*7711*77*411111224FCH*17727474*7741~HL*7**17*7~NM1*LL*1*VLILUJIF WJWC JFULLIFEC EP. PW ITCL*****LJ*51115~HL*1*7*17*7~NM1*7L*1*LLPWCUUJPFIW UCFBIW IWWJIFEC WWE*****WJ*131412725~HL*4*1*11*7~TRN*1*7*7131412725~NM1*JW*7*FIWWIEC*ILWJI****TJ*215177124~REF*5L*77441274*FPLBI ITCLJEIF UCFBIW VLPLL~N3*474 C IPTC UBLCCB~N4*FCF EIUBWC*LI*75777~DMG*U2*72217371*W~DTP*445*U2*17737777~DTP*443*U2*17477147~EB*F~MSG*OPLL HCFCWJB LCLJPU JU WLPT IIFLILO 7 BP UCECTHCL 47~EB*F~MSG*FPF-EPFBLIEBCU EPSCLIVC JU HIUCU PF LCIUPFIHWC IFU ELUBPTILO~EB*1**35**GUARDIAN~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U*AD:D0431~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC LCLIJL~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC LCHIUC~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC LCWJFC~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC IUILUBTCFBU~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC LCWJFC/LCHIUC~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=WWLPLJUC~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U*AD:D4910~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=EPTLPUJBCU~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=JTLWIFBU~MSG*UCULEBJHWC FIJSCU~EB*A**7**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**30**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=HJBCFJFV D-LIOU~MSG*UCULEBJHWC FIJSCU~EB*A**36**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=CDITU~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=WLWW TPLBI/LIFPLCD~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=IILTWLW IIHJBU ILLWJIFEC~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=EPFULWBIBJPF~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U*AD:D9940~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**40**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=LLPLIOWIDJU~MSG*UCULEBJHWC FIJSCU~EB*A**39**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=ITIWVIT & EPTLPUJBC~MSG*UCULEBJHWC FIJSCU~EB*A**98**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCIWIFBU~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U*AD:D0391~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**24**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**38**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.50****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**38**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*******U~MSG*EPSCLCU PF CWJVJHWC UCLCFUCFB EIJWULCF FIP ILC WCUU BIIF 72~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***1.00****U~MSG*HCFCWJBEWIUU=BTI BLCIBTCFB~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UJIVFPUBJE D-LIO~MSG*UCULEBJHWC FIJSCU~EB*A**25**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**26**DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=LCLJP ULLVCLO~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=JFWIO/PFWIO~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLCU~MSG*UCULEBJHWC FIJSCU~EB*A****DG ALLIANCE SELECT, DG ELITE, DG CONNECT***0.40****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=HLJWULLU/LPUB IFU EPLC~MSG*UCULEBJHWC FIJSCU~EB*A****DG PLUS, NON CONTRACTED***0.00****U*AD:D0431~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC LCLIJL~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC LCHIUC~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC LCWJFC~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC IUILUBTCFBU~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLC LCWJFC/LCHIUC~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=WWLPLJUC~MSG*UCULEBJHWC FIJSCU~EB*A****DG PLUS, NON CONTRACTED***0.20****U*AD:D4910~DTP*412*U2*17737777~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.20****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=EPTLPUJBCU~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=JTLWIFBU~MSG*UCULEBJHWC ILLWJCU~EB*A**7**DG PLUS, NON CONTRACTED***0.20****U~DTP*412*U2*17737777~MSG*UCULEBJHWC ILLWJCU~EB*A**30**DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=HJBCFJFV D-LIOU~MSG*UCULEBJHWC FIJSCU~EB*A**36**DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=CDITU~MSG*UCULEBJHWC FIJSCU~EB*A****DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=WLWW TPLBI/LIFPLCD~MSG*UCULEBJHWC FIJSCU~EB*A****DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=IILTWLW IIHJBU ILLWJIFEC~MSG*UCULEBJHWC FIJSCU~EB*A****DG PLUS, NON CONTRACTED***0.20****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=EPFULWBIBJPF~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.20****U*AD:D9940~DTP*412*U2*17737777~MSG*UCULEBJHWC ILLWJCU~EB*A**40**DG PLUS, NON CONTRACTED***0.20****U~DTP*412*U2*17737777~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=LLPLIOWIDJU~MSG*UCULEBJHWC FIJSCU~EB*A**39**DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.20****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=ITIWVIT & EPTLPUJBC~MSG*UCULEBJHWC ILLWJCU~EB*A**98**DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCIWIFBU~MSG*UCULEBJHWC FIJSCU~EB*A****DG PLUS, NON CONTRACTED***0.00****U*AD:D0391~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**24**DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**38**DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*UCULEBJHWC FIJSCU~EB*A**38**DG PLUS, NON CONTRACTED*******U~MSG*EPSCLCU PF CWJVJHWC UCLCFUCFB EIJWULCF FIP ILC WCUU BIIF 72~EB*A****DG PLUS, NON CONTRACTED***1.00****U~MSG*HCFCWJBEWIUU=BTI BLCIBTCFB~EB*A****DG PLUS, NON CONTRACTED***0.00****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UJIVFPUBJE D-LIO~MSG*UCULEBJHWC FIJSCU~EB*A**25**DG PLUS, NON CONTRACTED***0.20****U~DTP*412*U2*17737777~MSG*UCULEBJHWC ILLWJCU~EB*A**26**DG PLUS, NON CONTRACTED***0.20****U~DTP*412*U2*17737777~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.20****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=LCLJP ULLVCLO~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=JFWIO/PFWIO~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=UCFBLLCU~MSG*UCULEBJHWC ILLWJCU~EB*A****DG PLUS, NON CONTRACTED***0.50****U~DTP*412*U2*17737777~MSG*HCFCWJBEWIUU=HLJWULLU/LPUB IFU EPLC~MSG*UCULEBJHWC ILLWJCU~EB*C*IND*35**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*22******U~EB*C*FAM*35**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*22******U~EB*F*IND*35**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*23*2000.00*****U~EB*F*IND*35**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*29*2000.00*****U~EB*F*IND*38**DG ALLIANCE SELECT, DG ELITE, DG CONNECT*32*1000.00*****U~EB*C*IND*35**DG PLUS, NON CONTRACTED*22*50.00*****U~EB*C*IND*35**DG PLUS, NON CONTRACTED*29*50.00*****U~EB*C*FAM*35**DG PLUS, NON CONTRACTED*22*150.00*****U~EB*C*FAM*35**DG PLUS, NON CONTRACTED*29*150.00*****U~EB*F*IND*35**DG PLUS, NON CONTRACTED*23*2000.00*****U~EB*F*IND*35**DG PLUS, NON CONTRACTED*29*2000.00*****U~EB*F*IND*38**DG PLUS, NON CONTRACTED*32*1000.00*****U~EB*1**35*GP*GUARDIAN~EB*F~MSG*TLWBJ-SJUJB LLPECULLCU ILC LIJU PF BIC LLCLILIBJPF UIBC.~EB*F~MSG*FICF BIC CDLCEBCU EPUB PW I LLPLPUCU EPLLUC PW BLCIBTCFB JU $477 PL TPLC, FC LCEPTTCFU BIIB I LLCUCBCLTJFIBJPF HC ULHTJBBCU BP BIC EWIJTU IUULCUU.~EB*F********S8*40***AD:D0431~HSD*VS*1***34*24~EB*F~MSG*HCFCWJBEWIUU=UCFBLLC LCLIJL~EB*F~MSG*HCFCWJBEWIUU=UCFBLLC LCHIUC~EB*F~MSG*HCFCWJBEWIUU=UCFBLLC LCWJFC~EB*F~MSG*HCFCWJBEWIUU=UCFBLLC IUILUBTCFBU~EB*F~MSG*HCFCWJBEWIUU=UCFBLLC LCWJFC/LCHIUC~EB*F~HSD*VS*1***34*6~DTP*471*U2*22227777~MSG*HCFCWJBEWIUU=WWLPLJUC~MSG*FP IVC WJTJB.~EB*F************AD:D4910~DTP*471*U2*22227777~EB*F**35~MSG*LLCSCFBJSC UCLSJECU ILC CDCTLB WLPT BIC LCVLWIL IFFLIW TIDJTLT.~MSG*BCCBI TLUB HC CDBLIEBCU FIJWC JFULLCU FJBI BIJU VLILUJIF LWIF BP HC EPFUJUCLCU WPL LLPUBICBJE EPSCLIVC~MSG*BTI IIU I UCLILIBC $577 JFUJSJULIW UCULEBJHWC LCL               WJWCBJTC.~EB*F~MSG*HCFCWJBEWIUU=EPTLPUJBCU~MSG*LWIF UPCU FPB WJTJB ULLWIECU PW EPTLPUJBC LCUBPLIBJPFU.~MSG*LPUBCLJPL LCUJFU ILC FPB EPSCLCU, IF IWBCLFIBC HCFCWJB PW IF ITIWVIT LCUBPLIBJPF FJWW HC EPFUJUCLCU~EB*F~MSG*HCFCWJBEWIUU=JTLWIFBU~MSG*EPSCLCU FICF BICLC JU I WJIHJWJBO.~EB*I************AD:D4381~EB*F**7~MSG*EPFUJUCLCU FJBI BILCC PL TPLC EPSCLCU UJTLWC CDBLIEBJPFU PL IFO EPSCLCU ULLVJEIW LLPECULLC~EB*F**30~HSD*VS*1***34*12~DTP*471*U2*17727713~MSG*HCFCWJBEWIUU=HJBCFJFV D-LIOU~MSG*WJTJBCU BP CJBICL 1 JTIVCU PL I UCB PW SCLBJEIW HJBCFJFVU.~EB*F**36~MSG*UJFVWC ELPFFU ILC EPFUJUCLCU I TIIPL UCLSJEC.~EB*F~HSD*VS*1***34*6~DTP*471*U2*17727713~MSG*HCFCWJBEWIUU=CDITU~EB*F~HSD*VS*1***34*60~DTP*471*U2*22227777~MSG*HCFCWJBEWIUU=WLWW TPLBI/LIFPLCD~MSG*WJTJBCU BP CJBICL I WLWW TPLBI UCLJCU PL PFC LIFPLITJE WJWT~EB*F********S7*14~MSG*HCFCWJBEWIUU=IILTWLW IIHJBU ILLWJIFEC~MSG*EPSCLCU PFWO FICF FCCUCU BP JFIJHJB BILTH ULEPJFV; JFJBJIW ILLWJIFEC PFWO.~EB*F~MSG*HCFCWJBEWIUU=EPFULWBIBJPF~MSG*EPFULWBIBJPF, CSIWLIBJPF PW UWJUCU (U7121, U7124) EPSCLCU LFUCL BIC TIIPL EIBCVPLO.~EB*F************AD:D9940~HSD*VS*1***32*1~MSG*FICF LCLWPLTCU FJBIJF 5 TPFBIU PW PUUCPLU ULLVCLO~EB*F**40~MSG*PLIW ULLVCLO EWIJTU WLPT FPF EPFBLIEBCU LLPSJUCLU UIPLWU WJLUB HC ULHTJBBCU BP BIC JFULLCU'U TIIPL TCUJEIW EILLJCL.~EB*F************AD:D4341~HSD*VS*1***34*24~DTP*471*U2*22227777~MSG*LCL KLIULIFB, FICF FCCUCU ULC BP VJFVJSIW TJVLIBJPF IFU HPFC WPUU.~EB*F~HSD*VS*1***34*6~DTP*471*U2*17727713~MSG*HCFCWJBEWIUU=LLPLIOWIDJU~MSG*CJBICL PFC LCVLWIL LLPLIOWIDJU PL I LCLJPUPFBIW TIJFBCFIFEC LLPECULLC~EB*F**39~HSD*VS*1***21*5~HSD*VS*1***21*5~HSD*VS*1***21*5~MSG*ILLWJCU BP ELPFFU, JFWIOU IFU PFWIOU; FICF BIC ILLWJIFEC EIFFPB HC LCLIJLCU.~MSG*ILLWJCU BP LPUB IFU EPLCU; FICF JB EIFFPB HC LCLIJLCU.~MSG*ILLWJCU BP LILBJIWU, UCFBLLCU IFU HLJUVCU; FICF BIC ILLWJIFEC EIFFPB HC LCLIJLCU.~EB*F********S7*18~HSD*VS*1***34*12~MSG*HCFCWJBEWIUU=ITIWVIT & EPTLPUJBC~EB*F**98******S7*15~HSD*VS*1***34*36~MSG*HCFCWJBEWIUU=UCIWIFBU~MSG*WJTJBCU BP LCLTIFCFB LFLCUBPLCU TPWIL BCCBI PFWO.~EB*F~MSG*HCFCWJBEWIUU=BTI BLCIBTCFB~MSG*BIC WPWWPFJFV WJUB PW UCLSJECU ILC BIC PFWO UCLSJECU EPSCLCU LFUCL BIC BTI EIBCVPLO U7417-U7411,U3217,U3247,U3237.~EB*F************AD:D0391~EB*F**24~EB*F************AD:D0340~SE*375*0001~GE*1*342242985~IEA*1*342242985~";
			long provNum=ProviderT.CreateProvider("prov1","terry","smith",ssn:"123456789",isUsingTIN:true,nationalProvID:"0123456789");
			Prefs.UpdateLong(PrefName.PracticeDefaultProv,provNum);
			Patient pat=PatientT.CreatePatient(suffix,priProvNum:provNum,birthDate:DateTime.Today);
			//Create clearinghouse, set required fields for benefit request validation, and set as default.
			Clearinghouse ch=ClearinghouseT.CreateClearinghouse("ClaimConnect",commBridge:EclaimsCommBridge.ClaimConnect,eFormat:ElectronicClaimFormat.x837D_5010_dental,isa05:"ZZ",
				isa07:"30",isa08:"BCBSGA",isa15:"P");
			Prefs.UpdateLong(PrefName.ClearinghouseDefaultEligibility,ch.ClearinghouseNum);
			Prefs.RefreshCache();
			Clearinghouses.Insert(ch);
			//Create carrier and set required fields for benefit request validation
			Carrier carrier=CarrierT.CreateCarrier(suffix,"123 boring st","boring","OR","97306","1234",arrayTrustedEtrans:TrustedEtransTypes.RealTimeEligibility);
			Carriers.RefreshCache();
			InsPlan insPlan=InsPlanT.CreateInsPlan(carrier.CarrierNum,groupNum:"XYZ123");//Group number should be >3 characters so it passes insverify validation
			InsSub insSub=InsSubT.CreateInsSub(pat.PatNum,insPlan.PlanNum);
			PatPlan patPlan=PatPlanT.CreatePatPlan(1,pat.PatNum,insSub.InsSubNum);
			Operatory op=OperatoryT.CreateOperatory();
			AppointmentT.CreateAppointment(pat.PatNum,DateTime.Today,op.OperatoryNum,provNum);
			BenefitT.CreateAnnualMax(insPlan.PlanNum,BenefitCoverageLevel.Individual,2000);
			BenefitT.CreateDeductibleGeneral(insPlan.PlanNum,BenefitCoverageLevel.Family,500);
			List<InsVerify> listInsVerifies=InsVerifies.TryBatchPatInsVerify();
			//Should not pass validation because the benefits in the 271 do not match the benefits in OD.
			Assert.IsTrue(listInsVerifies.FirstOrDefault().BatchVerifyState==BatchInsVerifyState.Error);
			//More specifically we should get "Individual general deductible mismatch." and "Family general deductible mismatch."
			string[] errorNotes=listInsVerifies.FirstOrDefault().Note.Split('\n');
			Assert.IsTrue(errorNotes[0].Contains("Individual general deductible mismatch."));
			Assert.IsTrue(errorNotes[1].Contains("Family general deductible mismatch."));
		}

		[TestMethod]
		public void InsVerifies_Fake271ResponseMetlife_ShouldPassAllValidation() {
			AppointmentT.ClearAppointmentTable();
			CarrierT.ClearCarrierTable();
			string suffix=MethodBase.GetCurrentMethod().Name;
			x270Controller.FakeResponseOverride271="ISA*00*          *00*          *30*330989922      *ZZ*810624427      *191212*1221*U*00401*400512059*0*P*:~GS*HB*330989922*330989922*20191212*1221*400512059*X*004010X092A1~ST*271*0001~BHT*7711*77*177471742FCH*17727171*7117~HL*7**17*7~NM1*LL*1*TCBWJWC*****LJ*54232~HL*1*7*17*7~NM1*7L*7*LLPWCUUJPFIW UCFBIW IWWJIFEC WWE*****DD*7317421115~HL*4*1*11*7~NM1*JW*7*EILLPWW*IPWWO****TJ*427217752~REF*5L*474224*EPFIVLI HLIFUU JFE.~N3*772 VLIEC UBLCCB~N4*HLOIF*PI*14475~DMG*U2*72217247*W~HL*1*4*14*7~TRN*1*7*7131412725~NM1*74*7*EILLPWW*VLIUO*U***TJ*427217752~N3*772 VLIEC UBLCCB~N4*HLOIF*PI*14475~DMG*U2*17727771*T~INS*F*72~DTP*442*U2*17727777~DTP*415*U2*17727777~EB*F*IND*24***29*1717.20~EB*C*FAM*24**MET*32*0.00~EB*C*FAM*24**MET*22*0.00~EB*C*IND*24**MET*32*0.00~EB*C*IND*24**MET*22*0.00~EB*C*FAM*24***32*0.00~EB*C*FAM*24***22*0.00~EB*C*IND*24***32*0.00~EB*C*IND*24***22*0.00~EB*F*IND*38***33*2000.00~EB*C*FAM*38**MET*32*150.00~EB*C*FAM*38**MET*22*0.00~EB*C*IND*38**MET*32*75.00~EB*C*IND*38**MET*22*0.00~EB*C*FAM*38***32*0.00~EB*C*FAM*38***22*225.00~EB*C*IND*38***32*0.00~EB*C*IND*38***22*75.00~EB*F*IND****29*1717.20~MSG*HCFCWJBEWIUU=HIUJE~EB*C*FAM***MET*32*150.00~MSG*HCFCWJBEWIUU=HIUJE~EB*C*FAM***MET*22*0.00~MSG*HCFCWJBEWIUU=HIUJE~EB*C*IND***MET*32*75.00~MSG*HCFCWJBEWIUU=HIUJE~EB*C*IND***MET*22*0.00~MSG*HCFCWJBEWIUU=HIUJE~EB*C*FAM****32*0.00~MSG*HCFCWJBEWIUU=HIUJE~EB*C*FAM****22*225.00~MSG*HCFCWJBEWIUU=HIUJE~EB*C*IND****32*0.00~MSG*HCFCWJBEWIUU=HIUJE~EB*C*IND****22*75.00~MSG*HCFCWJBEWIUU=HIUJE~EB*F~MSG*FIJBJFV LCLJPU UPCU FPB ILLWO~EB*F************AD:D1351~MSG*UCEPFU TPWIL - LCLTIFCFB TPWILU PFWO, CDEWLUJFV FJUUPT BCCBI~EB*F************AD:D1351~MSG*WJLUB TPWIL - LCLTIFCFB TPWILU PFWO, CDEWLUJFV FJUUPT BCCBI~EB*F~MSG*LLJPL CDBLIEBJPFU ILC FPB EPSCLCU~EB*F~MSG*TLWBJ-SJUJB LLPECULLCU ILC LIJU PF UCIB UIBC~EB*F************AD:D2393~MSG*EPTLPUJBCU ILC FPB UPFFVLIUCU~EB*F************AD:D2750~MSG*LPLECWIJF JU FPB UPFFVLIUCU PF HJELULJUU~EB*F************AD:D2750~MSG*LPLECWIJF JU UPFFVLIUCU PF TPWILU~EB*1*ECH*30*GP*CONAGRA BRANDS INC.******U~MSG*BIC TIDJTLTU IFU UCULEBJHWCU WPL BICUC UCLSJECU TIO HC EPTHJFCU FJBI PBICL BOLCU PW LLPECULLCU, ULEI IU BTI PL LCLJP.~EB*F*IND*23*GP**22*2000.00****U*N~EB*A**23*GP****0.0***U*N~EB*F*IND*41*GP**22*2000.00****U*N~EB*A**41*GP****0.0***U*N~EB*F*IND*25*GP**22*2000.00****U*N~EB*A**25*GP****0.2***U*N~EB*F*IND*26*GP**22*2000.00****U*N~EB*A**26*GP****0.2***U*N~EB*F*IND*24*GP**22*2000.00****U*N~EB*A**24*GP****0.2***U*N~EB*F*IND*39*GP**22*2000.00****U*N~EB*C*IND*39*GP**22*75.00****U*N~EB*A**39*GP****0.5***U*N~EB*F*IND*40*GP**22*2000.00****U*N~EB*A**40*GP****0.2***U*N~EB*F*IND*38*GP**32*2000.00****U*N~EB*C*IND*38*GP**22*75.00****U*N~EB*A**38*GP****0.5***U*N~EB*A***GP****0.0***U*N*AD:D0150~HSD*VS*2***23*1~DTP*131*U2*17727412~EB*F*IND**GP**22*2000.00****U*N*AD:D0150~DTP*131*U2*17727412~EB*A***GP****0.0***U*N*AD:D0210~HSD*VS*1***34*60~EB*F*IND**GP**22*2000.00****U*N*AD:D0210~EB*A***GP****0.0*S7*26.0*U*N*AD:D0270~HSD*VS*2***23*1~DTP*131*U2*17727412~EB*A***GP****0.0*S8*27.0*U*N*AD:D0270~HSD*VS*1***23*1~DTP*131*U2*17727412~EB*F*IND**GP**22*2000.00****U*N*AD:D0270~DTP*131*U2*17727412~EB*I**********U*N*AD:D0431~EB*A***GP****0.0***U*N*AD:D1110~HSD*VS*2***23*1~DTP*131*U2*17727412~EB*F*IND**GP**22*2000.00****U*N*AD:D1110~DTP*131*U2*17727412~EB*A***GP****0.0*S7*16.0*U*N*AD:D1208~HSD*VS*2***23*1~DTP*131*U2*17727412~EB*F*IND**GP**22*2000.00****U*N*AD:D1208~DTP*131*U2*17727412~EB*A***GP****0.0*S7*19.0*U*N*AD:D1351~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D1351~EB*A***GP****0.0***U*N*AD:D1510~EB*F*IND**GP**22*2000.00****U*N*AD:D1510~EB*A***GP****0.2***U*N*AD:D2140~EB*F*IND**GP**22*2000.00****U*N*AD:D2140~EB*A***GP****0.2***U*N*AD:D2391~EB*F*IND**GP**22*2000.00****U*N*AD:D2391~EB*A***GP****0.5***U*N*AD:D2630~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D2630~EB*C*IND**GP**22*75.00****U*N*AD:D2630~EB*A***GP****0.5***U*N*AD:D2643~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D2643~EB*C*IND**GP**22*75.00****U*N*AD:D2643~EB*A***GP****0.5***U*N*AD:D2750~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D2750~EB*C*IND**GP**22*75.00****U*N*AD:D2750~EB*A***GP****0.5***U*N*AD:D2910~EB*F*IND**GP**22*2000.00****U*N*AD:D2910~EB*C*IND**GP**22*75.00****U*N*AD:D2910~EB*A***GP****0.5***U*N*AD:D2954~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D2954~EB*C*IND**GP**22*75.00****U*N*AD:D2954~EB*A***GP****0.5***U*N*AD:D2980~EB*F*IND**GP**22*2000.00****U*N*AD:D2980~EB*C*IND**GP**22*75.00****U*N*AD:D2980~EB*A***GP****0.2***U*N*AD:D3310~EB*F*IND**GP**22*2000.00****U*N*AD:D3310~EB*A***GP****0.2***U*N*AD:D4260~EB*F*IND**GP**22*2000.00****U*N*AD:D4260~EB*A***GP****0.2***U*N*AD:D4341~EB*F*IND**GP**22*2000.00****U*N*AD:D4341~EB*I**********U*N*AD:D4381~EB*A***GP****0.2***U*N*AD:D4910~HSD*VS*4***23*1~EB*F*IND**GP**22*2000.00****U*N*AD:D4910~EB*A***GP****0.5***U*N*AD:D5110~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D5110~EB*C*IND**GP**22*75.00****U*N*AD:D5110~EB*A***GP****0.2***U*N*AD:D5670~EB*F*IND**GP**22*2000.00****U*N*AD:D5670~EB*A***GP****0.2***U*N*AD:D5751~EB*F*IND**GP**22*2000.00****U*N*AD:D5751~EB*A***GP****0.5***U*N*AD:D6010~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D6010~EB*C*IND**GP**22*75.00****U*N*AD:D6010~EB*A***GP****0.5***U*N*AD:D6013~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D6013~EB*C*IND**GP**22*75.00****U*N*AD:D6013~EB*A***GP****0.5***U*N*AD:D6210~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*N*AD:D6210~EB*C*IND**GP**22*75.00****U*N*AD:D6210~EB*A***GP****0.2***U*N*AD:D7140~EB*F*IND**GP**22*2000.00****U*N*AD:D7140~EB*A***GP****0.2***U*N*AD:D7240~EB*F*IND**GP**22*2000.00****U*N*AD:D7240~EB*I**********U*N*AD:D7880~EB*A***GP****0.5***U*N*AD:D8070~EB*F*IND**GP**32*2000.00****U*N*AD:D8070~EB*C*IND**GP**22*75.00****U*N*AD:D8070~EB*A***GP****0.0***U*N*AD:D9110~EB*F*IND**GP**22*2000.00****U*N*AD:D9110~EB*A***GP****0.2***U*N*AD:D9222~EB*F*IND**GP**22*2000.00****U*N*AD:D9222~EB*I**********U*N*AD:D9944~EB*I**********U*N*AD:D9972~EB*F*IND*23*GP**22*2000.00****U*Y~EB*A**23*GP****0.0***U*Y~EB*F*IND*41*GP**22*2000.00****U*Y~EB*A**41*GP****0.0***U*Y~EB*F*IND*25*GP**22*2000.00****U*Y~EB*A**25*GP****0.2***U*Y~EB*F*IND*26*GP**22*2000.00****U*Y~EB*A**26*GP****0.2***U*Y~EB*F*IND*24*GP**22*2000.00****U*Y~EB*A**24*GP****0.2***U*Y~EB*F*IND*39*GP**22*2000.00****U*Y~EB*C*IND*39*GP**22*75.00****U*Y~EB*A**39*GP****0.5***U*Y~EB*F*IND*40*GP**22*2000.00****U*Y~EB*A**40*GP****0.2***U*Y~EB*F*IND*38*GP**32*2000.00****U*Y~EB*C*IND*38*GP**22*75.00****U*Y~EB*A**38*GP****0.5***U*Y~EB*A***GP****0.0***U*Y*AD:D0150~HSD*VS*2***23*1~DTP*131*U2*17727412~EB*F*IND**GP**22*2000.00****U*Y*AD:D0150~DTP*131*U2*17727412~EB*CB******37.00****U*Y*AD:D0150~DTP*131*U2*17727412~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.0***U*Y*AD:D0210~HSD*VS*1***34*60~EB*F*IND**GP**22*2000.00****U*Y*AD:D0210~EB*CB******73.00****U*Y*AD:D0210~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.0*S7*26.0*U*Y*AD:D0270~HSD*VS*2***23*1~DTP*131*U2*17727412~EB*A***GP****0.0*S8*27.0*U*Y*AD:D0270~HSD*VS*1***23*1~DTP*131*U2*17727412~EB*F*IND**GP**22*2000.00****U*Y*AD:D0270~DTP*131*U2*17727412~EB*CB******14.00****U*Y*AD:D0270~DTP*131*U2*17727412~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*I**********U*Y*AD:D0431~EB*A***GP****0.0***U*Y*AD:D1110~HSD*VS*2***23*1~DTP*131*U2*17727412~EB*F*IND**GP**22*2000.00****U*Y*AD:D1110~DTP*131*U2*17727412~EB*CB******55.00****U*Y*AD:D1110~DTP*131*U2*17727412~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.0*S7*16.0*U*Y*AD:D1208~HSD*VS*2***23*1~DTP*131*U2*17727412~EB*F*IND**GP**22*2000.00****U*Y*AD:D1208~DTP*131*U2*17727412~EB*CB******24.00****U*Y*AD:D1208~DTP*131*U2*17727412~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.0*S7*19.0*U*Y*AD:D1351~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D1351~EB*CB******30.00****U*Y*AD:D1351~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.0***U*Y*AD:D1510~EB*F*IND**GP**22*2000.00****U*Y*AD:D1510~EB*CB******236.00****U*Y*AD:D1510~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D2140~EB*F*IND**GP**22*2000.00****U*Y*AD:D2140~EB*CB******70.00****U*Y*AD:D2140~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D2391~EB*F*IND**GP**22*2000.00****U*Y*AD:D2391~EB*CB******84.00****U*Y*AD:D2391~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D2630~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D2630~EB*C*IND**GP**22*75.00****U*Y*AD:D2630~EB*CB******595.00****U*Y*AD:D2630~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D2643~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D2643~EB*C*IND**GP**22*75.00****U*Y*AD:D2643~EB*CB******700.00****U*Y*AD:D2643~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D2750~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D2750~EB*C*IND**GP**22*75.00****U*Y*AD:D2750~EB*CB******665.00****U*Y*AD:D2750~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D2910~EB*F*IND**GP**22*2000.00****U*Y*AD:D2910~EB*C*IND**GP**22*75.00****U*Y*AD:D2910~EB*CB******46.00****U*Y*AD:D2910~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D2954~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D2954~EB*C*IND**GP**22*75.00****U*Y*AD:D2954~EB*CB******168.00****U*Y*AD:D2954~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D2980~EB*F*IND**GP**22*2000.00****U*Y*AD:D2980~EB*C*IND**GP**22*75.00****U*Y*AD:D2980~EB*CB******122.00****U*Y*AD:D2980~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D3310~EB*F*IND**GP**22*2000.00****U*Y*AD:D3310~EB*CB******421.00****U*Y*AD:D3310~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D4260~EB*F*IND**GP**22*2000.00****U*Y*AD:D4260~EB*CB******680.00****U*Y*AD:D4260~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D4341~EB*F*IND**GP**22*2000.00****U*Y*AD:D4341~EB*CB******132.00****U*Y*AD:D4341~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*I**********U*Y*AD:D4381~EB*A***GP****0.2***U*Y*AD:D4910~HSD*VS*4***23*1~EB*F*IND**GP**22*2000.00****U*Y*AD:D4910~EB*CB******80.00****U*Y*AD:D4910~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D5110~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D5110~EB*C*IND**GP**22*75.00****U*Y*AD:D5110~EB*CB******835.00****U*Y*AD:D5110~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D5670~EB*F*IND**GP**22*2000.00****U*Y*AD:D5670~EB*CB******264.00****U*Y*AD:D5670~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D5751~EB*F*IND**GP**22*2000.00****U*Y*AD:D5751~EB*CB******251.00****U*Y*AD:D5751~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D6010~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D6010~EB*C*IND**GP**22*75.00****U*Y*AD:D6010~EB*CB******1261.00****U*Y*AD:D6010~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D6013~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D6013~EB*C*IND**GP**22*75.00****U*Y*AD:D6013~EB*CB******1249.00****U*Y*AD:D6013~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.5***U*Y*AD:D6210~HSD*VS*1***23*5~EB*F*IND**GP**22*2000.00****U*Y*AD:D6210~EB*C*IND**GP**22*75.00****U*Y*AD:D6210~EB*CB******596.00****U*Y*AD:D6210~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D7140~EB*F*IND**GP**22*2000.00****U*Y*AD:D7140~EB*CB******79.00****U*Y*AD:D7140~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D7240~EB*F*IND**GP**22*2000.00****U*Y*AD:D7240~EB*CB******269.00****U*Y*AD:D7240~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*I**********U*Y*AD:D7880~EB*A***GP****0.5***U*Y*AD:D8070~EB*F*IND**GP**32*2000.00****U*Y*AD:D8070~EB*C*IND**GP**22*75.00****U*Y*AD:D8070~EB*A***GP****0.0***U*Y*AD:D9110~EB*F*IND**GP**22*2000.00****U*Y*AD:D9110~EB*CB******51.00****U*Y*AD:D9110~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*A***GP****0.2***U*Y*AD:D9222~EB*F*IND**GP**22*2000.00****U*Y*AD:D9222~EB*CB******106.00****U*Y*AD:D9222~MSG*HCFCWJB ITPLFB = TIDJTLT IWWPFIHWC EIILVC~EB*I**********U*Y*AD:D9944~EB*I**********U*Y*AD:D9972~SE*378*0001~GE*1*400512059~IEA*1*400512059~";
			long provNum=ProviderT.CreateProvider("prov1","terry","smith",ssn:"123456789",isUsingTIN:true,nationalProvID:"0123456789");
			Prefs.UpdateLong(PrefName.PracticeDefaultProv,provNum);
			Patient pat=PatientT.CreatePatient(suffix,priProvNum:provNum,birthDate:DateTime.Today);
			//Create clearinghouse, set required fields for benefit request validation, and set as default.
			Clearinghouse ch=ClearinghouseT.CreateClearinghouse("ClaimConnect",commBridge:EclaimsCommBridge.ClaimConnect,eFormat:ElectronicClaimFormat.x837D_5010_dental,isa05:"ZZ",
				isa07:"30",isa08:"BCBSGA",isa15:"P");
			Prefs.UpdateLong(PrefName.ClearinghouseDefaultEligibility,ch.ClearinghouseNum);
			Prefs.RefreshCache();
			Clearinghouses.Insert(ch);
			//Create carrier and set required fields for benefit request validation
			Carrier carrier=CarrierT.CreateCarrier(suffix,"123 boring st","boring","OR","97306","1234",arrayTrustedEtrans:TrustedEtransTypes.RealTimeEligibility);
			Carriers.RefreshCache();
			InsPlan insPlan=InsPlanT.CreateInsPlan(carrier.CarrierNum,groupNum:"XYZ123");//Group number should be >3 characters so it passes insverify validation
			InsSub insSub=InsSubT.CreateInsSub(pat.PatNum,insPlan.PlanNum);
			PatPlan patPlan=PatPlanT.CreatePatPlan(1,pat.PatNum,insSub.InsSubNum);
			Operatory op=OperatoryT.CreateOperatory();
			//Create benefits for the plan
			BenefitT.CreateAnnualMax(insPlan.PlanNum,BenefitCoverageLevel.Individual,2000);
			BenefitT.CreateDeductibleGeneral(insPlan.PlanNum,BenefitCoverageLevel.Individual,75);
			BenefitT.CreateAnnualMax(insPlan.PlanNum,BenefitCoverageLevel.Family,2000);
			BenefitT.CreateDeductibleGeneral(insPlan.PlanNum,BenefitCoverageLevel.Family,225);
			AppointmentT.CreateAppointment(pat.PatNum,DateTime.Today,op.OperatoryNum,provNum);
			List<InsVerify> listInsVerifies=InsVerifies.TryBatchPatInsVerify();
			//Should only be one patient in the list and they should have passed validation.
			Assert.IsTrue(listInsVerifies.FirstOrDefault().BatchVerifyState==BatchInsVerifyState.Success);
		}
	}
}
